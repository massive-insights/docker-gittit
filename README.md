# Docker image for Gitit

This is the Git repo of the Docker image for the wiki system [Gitit](https://github.com/jgm/gitit). It contains a build definition and all supporting files for building an appropriate Docker image. The automated build is available on Docker Hub as [minsights/gitit](https://hub.docker.com/r/minsights/gitit).

## What is Gitit?

Gitit is a wiki system written in Haskell. It uses [http://happstack.com/page/view-page-slug/1/happstack](Happstack) for the web server and [pandoc](http://pandoc.org) for markup processing. Pages and uploaded files are stored in a Git, Darcs, or Mercurial repository and may be modified either by using the VCS's command-line tools or through the wiki's web interface.

## Preequisites

- Docker Engine 17.12.0 or higher
- Docker Compose 1.18.0 or higher 

### Install Docker Compose

Docker Compose relies on Docker Engine, so make sure you have Docker Engine installed. Depending on your environment you might already have Docker Compose installed.

*macOS*

When using [Docker for Mac](https://docs.docker.com/docker-for-mac/install) or [Docker Toolbox](https://docs.docker.com/toolbox/overview) (for older systems), Docker Compose is already included as part of the installation along with other Docker apps.

*Windows*

When using [Docker for Windows](https://docs.docker.com/docker-for-windows/install) or [Docker Toolbox](https://docs.docker.com/toolbox/overview) (for older systems), Docker Compose is already included as part of the installation along with other Docker apps.

*Linux*

On Linux, download the Docker Compose binary from the [repository release page](https://github.com/docker/compose/releases) on GitHub: 

```bash
$ sudo curl -L https://github.com/docker/compose/releases/download/1.18.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
```

... and make the binary executable:

```bash
$ sudo chmod +x /usr/local/bin/docker-compose
```

Finally check if Docker Compose have been installed properly:

```bash
$ docker-compose --version
```

You should get a feedback message similar to:

```
docker-compose version 1.18.0, build 8dd22a9
```

## Build Docker container

We use Docker Compose to build the Docker container:

```bash
$ docker-compose build
```

## Launch Docker container

If you don't already use Gitit, we need to trigger the initial installation via:

```bash
$ sudo docker run -d --name gitit -p 5001:5001 massive-insights/gitit
```

Assuming that we already use Gitgit and it's installed in /home/gitgit/wiki we need to mount it as a volume:

```bash
$ sudo docker run -d --name gitit -p 5001:5001 -v /home/gitit/wiki:/data massive-insights/gitit
```

Gitit uses the following volumes and files:

- `/data` -> main data volume that will be generated initially when it doesn't exists during launch
- `/data/gitgit.conf` -> main configuration file for Gitgit. If it's not provided as volume when starting the container, a default configuration file will be generated
- `/data/static` -> directory that contains all static files (CSS and images) that are required by Gitgit. This directory will be generated automatically, when not provided as volume during start
- `/data/templates` -> directory that contains HStringTemplate templates for wiki pages. When not provided as volume during start, this directory will be automatically generated
- `/data/wikidata` -> directory where all wiki pages resist. When not provided as volume during start, this directory will be autogenerated.

## Cheat sheet

Stop all Docker containers and remove all Docker instances and images:

```bash
$ docker stop $(docker ps -a -q); docker rm $(docker ps -a -q); docker rmi $(docker images -a -q)
```

Hook into a running Docker container and spawn a shell:

```bash
$ docker exec -it dockergitit_wiki_1 bash
```

